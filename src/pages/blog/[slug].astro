---
import BlogPostLayout from "../../layouts/BlogPost.astro";
import ArticleShareCard from "../../components/ArticleShareCard.svelte";
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  
  return posts.map(post => {
    // Générer un slug directement ici sans fonction auxiliaire
    const slug = post.data.title
      .toLowerCase()
      .replace(/[^\w\s]/g, '')
      .replace(/\s+/g, '-');
    
    return {
      params: { slug },
      props: { post },
    };
  });
}

const { post } = Astro.props;
const { Content } = await render(post);

//
---

<BlogPostLayout frontmatter={post.data}>
  <!-- Contenu de l'article -->
  <div class="article-body">
    <Content />
  </div>
  
  <!-- Mention de source -->
  <div class="article-source">
    <p>Source : <a href={Astro.url.href}>{Astro.url.href}</a></p>
  </div>
    <!-- Encadré de partage -->
    <ArticleShareCard client:load
      title={post.data.title}
      url={Astro.url.href}
      description={post.data.description || ''}
    />
  
  <!-- Boutons de navigation -->
  <div class="article-navigation">
    <a href="/blog" class="nav-button secondary-button">
      <span class="nav-icon">←</span> Retour aux actualités
    </a>
    <a href="/" class="nav-button primary-button">
      Retour à l'accueil
    </a>
  </div>


</BlogPostLayout>