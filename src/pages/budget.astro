---
import Layout from '../layouts/Layout.astro';
import Chart from '../components/Chart.astro';
import FinancialTable from '../components/FinancialTable.astro';
import ChartAccordion from '../components/ChartAccordion.astro';
import BudgetNavigation from '../components/BudgetNavigation.astro';
import { readFileSync } from 'fs';

interface DetailsOfOperatingExpenses2024 {
  compte: string;
  libelle: string;
  montant_realise: number;
}

interface DetailsOfOperatingIncomes2024 {
  compte: string;
  libelle: string;
  montant_realise: number;
}

// Lecture des donn√©es pour le graphique des d√©penses
const jsonContent = readFileSync('public/assets/datas/details-of-operating-expenses-2024.json', 'utf-8');
const data = JSON.parse(jsonContent);

// Lecture des donn√©es pour le graphique des recettes
const incomesContent = readFileSync('public/assets/datas/details_of-operating-incomes-2024.json', 'utf-8');
const incomesData = JSON.parse(incomesContent);

// Lecture des donn√©es pour le tableau de la section de fonctionnement
const overviewContent = readFileSync('public/assets/datas/overview-of-operating-section-2024.json', 'utf-8');
const overviewData = JSON.parse(overviewContent);

// Lecture des donn√©es pour le tableau d'investissement
const investmentContent = readFileSync('public/assets/datas/overview-of-investing-section-2024.json', 'utf-8');
const investmentData = JSON.parse(investmentContent);

// Utilisation des vraies donn√©es avec les bonnes cl√©s
const depensesData: DetailsOfOperatingExpenses2024[] = data.details_of_operating_expenses_2024 as DetailsOfOperatingExpenses2024[];
const recettesData: DetailsOfOperatingIncomes2024[] = incomesData.details_of_operating_incomes_2024 as DetailsOfOperatingIncomes2024[];
---

<Layout title="Budget 2024 - MCC Putanges-le-Lac">
  <main>
    <!-- Navigation sidebar -->
    <BudgetNavigation />
    
    <!-- Message d'avertissement pour les petits √©crans -->
    <div class="screen-warning">
      <div class="warning-content">
        <h2>üìä Consultation du Budget</h2>
        <p>Pour une meilleure exp√©rience de consultation des donn√©es budg√©taires, nous vous recommandons d'utiliser un ordinateur ou un √©cran plus large.</p>
        <div class="warning-details">
          <p><strong>R√©solution minimale recommand√©e :</strong> 1400px de largeur</p>
          <p>Cette page contient des graphiques d√©taill√©s qui n√©cessitent plus d'espace d'affichage pour une lecture optimale.</p>
        </div>
        <div class="warning-actions">
          <a href="/" class="btn-home">‚Üê Retour √† l'accueil</a>
        </div>
      </div>
    </div>

    <!-- Contenu principal (masqu√© sur petits √©crans) -->
    <section class="budget-section">
      <h1>Budget 2024</h1>
      
      <!-- Tableau financier - Section de fonctionnement -->
      <div id="section-fonctionnement" class="budget-anchor">
        <FinancialTable data={overviewData} />
      </div>
      
      <!-- Section d√©tails de fonctionnement -->
      <div id="detail-section-fonctionnement" class="budget-anchor">
        <!-- Accord√©on pour les d√©penses de fonctionnement -->
        <ChartAccordion title="D√©tail des d√©penses de fonctionnement 2024">
          <div id="detail-depenses-fonctionnement" class="budget-anchor chart-section">
            <Chart 
              data={depensesData}
              title="D√©tail des d√©penses de fonctionnement 2024"
              totalLabel="Total des d√©penses de fonctionnement"
              chartColors={[
                '#e74c3c', '#c0392b', '#a93226', '#922b21', '#7b241c', '#641e16',
                '#d35400', '#b7410e', '#9c2706', '#873600', '#762d00', '#662500',
                '#f39c12', '#d68910', '#b7750f', '#9a650e', '#82550c', '#6e450a',
                '#e67e22', '#dc7633', '#d5611b', '#ca5d15', '#bf590f', '#b45309'
              ]}
            />
          </div>
        </ChartAccordion>
        
        <!-- Accord√©on pour les recettes de fonctionnement -->
        <ChartAccordion title="D√©tail des recettes de fonctionnement 2024">
          <div id="detail-recettes-fonctionnement" class="budget-anchor chart-section">
            <Chart 
              data={recettesData}
              title="D√©tail des recettes de fonctionnement 2024"
              totalLabel="Total des recettes de fonctionnement"
              chartColors={[
                '#27ae60', '#229954', '#1e8449', '#196f3d', '#145a32', '#0f4c27',
                '#16a085', '#138d75', '#117a65', '#0e6655', '#0b5345', '#094135',
                '#2ecc71', '#28b463', '#239b56', '#1f8b4c', '#1a7b42', '#166a36',
                '#58d68d', '#52c882', '#4caf76', '#45976a', '#3f7f5e', '#396652'
              ]}
            />
          </div>
        </ChartAccordion>
      </div>

      <!-- Tableau financier - Section d'investissement -->
      <div id="section-investissement" class="budget-anchor">
        <FinancialTable data={investmentData} />
      </div>
    </section>
  </main>
</Layout>

<style>
    main {
        width: auto;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 2rem 0 320px; /* Marge droite restaur√©e + espace pour la sidebar */
    }

    /* Message d'avertissement - masqu√© par d√©faut */
    .screen-warning {
      display: none;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }

    .warning-content {
      max-width: 600px;
      text-align: center;
      background: white;
      padding: 3rem;
      border-radius: 1.5rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 2px solid #2e8b57;
    }

    .warning-content h2 {
      color: #2e8b57;
      margin-bottom: 1.5rem;
      font-size: 2rem;
    }

    .warning-content p {
      color: #495057;
      margin-bottom: 1rem;
      line-height: 1.6;
      font-size: 1.1rem;
    }

    .warning-details {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 1rem;
      margin: 2rem 0;
      border-left: 4px solid #2e8b57;
    }

    .warning-details p {
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .btn-home {
      display: inline-block;
      padding: 1rem 2rem;
      background: #2e8b57;
      color: white;
      text-decoration: none;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: all 0.2s ease;
      margin-top: 1rem;
    }

    .btn-home:hover {
      background: #1b5e39;
      transform: translateY(-2px);
    }

    /* Styles pour les ancres de navigation */
    .budget-anchor {
      scroll-margin-top: 100px; /* D√©calage pour √©viter le header */
      position: relative;
    }

    /* Affichage conditionnel bas√© sur la largeur d'√©cran */
    @media (max-width: 1399px) {
      .screen-warning {
        display: flex;
      }
      
      .budget-section {
        display: none;
      }

      main {
        padding: 0 1rem; /* Retour au padding normal sur petits √©crans */
      }
    }

    /* Styles pour √©crans ‚â• 1400px */
    @media (min-width: 1400px) {
      .screen-warning {
        display: none;
      }
      
      .budget-section {
        display: block;
        padding: 2rem 0;
        width: 100%;
      }
    }
    
    h1 {
      text-align: center;
      margin-bottom: 3rem;
      font-size: 2.5rem;
      color: var(--primary);
      font-family: var(--font-main);
      font-weight: 700;
    }

    /* Espacement entre le tableau et le graphique */
    .budget-section > :global(.financial-table-container) {
      margin-bottom: 4rem;
    }

    /* Espacement pour l'accord√©on des graphiques */
    .budget-section > :global(.chart-accordion) {
      margin-bottom: 4rem;
    }

    /* Espacement sp√©cifique pour le dernier √©l√©ment */
    .budget-section > :global(*:last-child) {
      margin-bottom: 2rem;
    }

    /* Ajustement de l'espacement des graphiques dans l'accord√©on */
    :global(.accordion-body .chart-component-container) {
      margin-bottom: 3rem;
    }

    :global(.accordion-body .chart-component-container:last-child) {
      margin-bottom: 0;
    }

    .chart-section {
      scroll-margin-top: 120px;
      position: relative;
      z-index: 1;
    }

    /* Ajustements pour les tr√®s grands √©crans */
    @media (min-width: 1600px) {
      main {
        max-width: 1600px;
        padding: 0 3rem 0 380px; /* Ajustement pour la sidebar plus large */
      }
      
      .budget-section {
        padding: 3rem 0;
      }
    }

    /* Ajustements pour les √©crans moyens */
    @media (min-width: 1400px) and (max-width: 1599px) {
      main {
        padding: 0 2rem 0 340px; /* Ajustement pour la sidebar plus compacte */
      }
    }
</style>
