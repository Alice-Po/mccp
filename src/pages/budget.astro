---
import Layout from '../layouts/Layout.astro';
import Chart from '../components/Chart.astro';
import FinancialTable from '../components/FinancialTable.astro';
import { readFileSync } from 'fs';

interface DetailsOfOperatingExpenses2024 {
  compte: string;
  libelle: string;
  montant_realise: number;
}

// Lecture des donn√©es pour le graphique
const jsonContent = readFileSync('public/assets/datas/details-of-operating-expenses-2024.json', 'utf-8');
const data = JSON.parse(jsonContent);

// Lecture des donn√©es pour le tableau de la section de fonctionnement
const overviewContent = readFileSync('public/assets/datas/overview-of-operating-section-2024.json', 'utf-8');
const overviewData = JSON.parse(overviewContent);

// Lecture des donn√©es pour le tableau d'investissement
const investmentContent = readFileSync('public/assets/datas/overview-of-investing-section-2024.json', 'utf-8');
const investmentData = JSON.parse(investmentContent);

// Utilisation des vraies donn√©es avec la bonne cl√©
const depensesData: DetailsOfOperatingExpenses2024[] = data.details_of_operating_expenses_2024 as DetailsOfOperatingExpenses2024[];
---

<Layout title="Budget 2024 - MCC Putanges-le-Lac">
  <main>
    <!-- Message d'avertissement pour les petits √©crans -->
    <div class="screen-warning">
      <div class="warning-content">
        <h2>üìä Consultation du Budget</h2>
        <p>Pour une meilleure exp√©rience de consultation des donn√©es budg√©taires, nous vous recommandons d'utiliser un ordinateur ou un √©cran plus large.</p>
        <div class="warning-details">
          <p><strong>R√©solution minimale recommand√©e :</strong> 1400px de largeur</p>
          <p>Cette page contient des graphiques d√©taill√©s qui n√©cessitent plus d'espace d'affichage pour une lecture optimale.</p>
        </div>
        <div class="warning-actions">
          <a href="/" class="btn-home">‚Üê Retour √† l'accueil</a>
        </div>
      </div>
    </div>

    <!-- Contenu principal (masqu√© sur petits √©crans) -->
    <section class="budget-section">
      <h1>Budget 2024</h1>
      
      <!-- Tableau financier comparatif - Section de fonctionnement -->
      <FinancialTable data={overviewData} />
      
      <!-- Graphique d√©taill√© des d√©penses -->
      <Chart 
        data={depensesData}
        title="D√©tail des d√©penses de fonctionnement 2024"
        totalLabel="Total des d√©penses de fonctionnement"
      />
      
      <!-- Tableau financier comparatif - Section d'investissement -->
      <FinancialTable data={investmentData} />
    </section>
  </main>
</Layout>

<style>
    main {
        width: auto;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    /* Message d'avertissement - masqu√© par d√©faut */
    .screen-warning {
      display: none;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }

    .warning-content {
      max-width: 600px;
      text-align: center;
      background: white;
      padding: 3rem;
      border-radius: 1.5rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 2px solid #2e8b57;
    }

    .warning-content h2 {
      color: #2e8b57;
      margin-bottom: 1.5rem;
      font-size: 2rem;
    }

    .warning-content p {
      color: #495057;
      margin-bottom: 1rem;
      line-height: 1.6;
      font-size: 1.1rem;
    }

    .warning-details {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 1rem;
      margin: 2rem 0;
      border-left: 4px solid #2e8b57;
    }

    .warning-details p {
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .btn-home {
      display: inline-block;
      padding: 1rem 2rem;
      background: #2e8b57;
      color: white;
      text-decoration: none;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: all 0.2s ease;
      margin-top: 1rem;
    }

    .btn-home:hover {
      background: #1b5e39;
      transform: translateY(-2px);
    }

    /* Affichage conditionnel bas√© sur la largeur d'√©cran */
    @media (max-width: 1399px) {
      .screen-warning {
        display: flex;
      }
      
      .budget-section {
        display: none;
      }
    }

    /* Styles pour √©crans ‚â• 1400px */
    @media (min-width: 1400px) {
      .screen-warning {
        display: none;
      }
      
      .budget-section {
        display: block;
        padding: 2rem 0;
        width: 100%;
      }
    }
    
    h1 {
      text-align: center;
      margin-bottom: 3rem;
      font-size: 2.5rem;
      color: var(--primary);
      font-family: var(--font-main);
      font-weight: 700;
    }

    /* Espacement entre le tableau et le graphique */
    .budget-section > :global(.financial-table-container) {
      margin-bottom: 4rem;
    }

    /* Espacement sp√©cifique pour le dernier tableau (investissement) */
    .budget-section > :global(.financial-table-container:last-child) {
      margin-top: 4rem;
      margin-bottom: 2rem;
    }

    /* Am√©lioration responsive pour les plus grandes r√©solutions */
    @media (min-width: 1600px) {
      main {
        max-width: 1600px;
      }
      
      .budget-section {
        padding: 3rem 1rem;
      }
    }
</style>
